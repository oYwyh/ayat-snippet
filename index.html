<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HI</title>
    <link rel="stylesheet" href="main.css/main.css">
    <link rel="preload" as="font" type="font/woff2" href="fonts/sura_names.woff2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/colorjoe.css">
    <script src="js/colorjoe.min.js"></script>
</head>
<body>
    <nav class="header">
        <div class="logo">
            <!-- 093surah => الضحى -->
            Ayat <span>snippet</span>
        </div>  
        <div class="options">
            <button class="primary">Theme</button>
            <button class="secondary" id="export">Export</button>
        </div>
    </nav>
    <div class="wrapper">
            <div class="surah-options">
                <div class="title">Surah Customaization! </div>
                <div class="chooser">
                    <div class="wrapper">
                        <div class="select-btn">
                            <span>Choose Surah</span>
                            <div class="icon"><i class="fa-solid fa-chevron-down"></i></div>
                        </div>
                        <div class="content">
                            <div class="search">
                                <i class="fa-solid fa-search"></i>
                                <input type="text" placeholder="Choose Surah!">
                            </div>
                            <div class="options">
                                <ul>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="snippet">
                <div class="snip" id="snip">
                    <div class="column">
                        <img src="images/frame/frame.png" id="surah-frame" alt="">
                        <div class="surah-name">091surah</div>
                    </div>
                    <div class="basmala">
                        <img src="../images/basmala.png" alt="">
                        <!-- <img src="https://upload.wikimedia.org/wikipedia/commons/2/27/Basmala.svg" alt="alt"> -->
                    </div>
                    <div id="row-verses" class="row">
                        <p class="verse">
                        وَٱلشَّمۡسِ وَضُحَىٰهَا <span class="verse-frame">1</span>
                        وَٱلۡقَمَرِ إِذَا تَلَىٰهَا <span class="verse-frame">2</span>
                        وَٱلنَّهَارِ إِذَا جَلَّىٰهَا <span class="verse-frame">3</span>
                    </p>
                    </div>
                </div>
            </div>
            <div class="styler">
                <div class="title">Background</div>
                <div class="row">
                    <div class="column">
                        <label for="">width</label>
                        <input type="number" id="width" value="600">
                    </div>
                    <div class="column">
                        <label for="">height</label>
                        <input type="number" id="height" value="700">
                    </div>
                </div>
                <div class="title">Fill</div>
                <div class="column" style="gap:1rem;">
                    <div class="row">
                        <i class="fa-solid fa-palette" style="color: #000000;"></i>
                        <div class="color-picker-div"></div>
                    </div>
                    <div class="row">
                        <i class="fa-solid fa-image" style="color: #000000;"></i>
                        <div class="img-chooser"></div>
                    </div>
                </div>
                <div class="color-options close" id="color-options">
                    <div class="close" id="close-picker"><i class="fa-solid fa-xmark"></i></div>
                    <ul>
                        <li>solid</li>
                        <li>gradiant</li>
                    </ul>
                    <div class="color-container">
                        <div class="colorjoe"></div>
                        <div class="config">
                            <div class="config-title">Selected Color</div>
                            <div class="row">
                                <div class="selected-color"></div>
                                <input type="text" class="selected-color-text" readonly>
                                <div class="copy"><i class="fa-solid fa-clipboard" style="color: #ffffff;"></i></div>
                            </div>
                            <div class="config-title">Saved Colors</div>
                            <div class="saved-color-div">
                                <div class="saved-color"></div>
                                <div class="saved-color"></div>
                                <div class="saved-color"></div>
                                <div class="saved-color"></div>
                                <div class="saved-color"></div>
                            </div>
                            <div class="config-title">Our Suggestion!</div>
                            <div class="suggested-color-div">
                                <div class="suggested-color"></div>
                                <div class="suggested-color"></div>
                                <div class="suggested-color"></div>
                                <div class="suggested-color"></div>
                            </div>
                            <div class="config-title">Add Your Own Hex Code!</div>
                            <div class="row">
                                <div class="hex-color-div"></div>
                                <input type="text" class="hex-color" value="#">
                                <div class="check"><i class="fa-solid fa-check" style="color: #ffffff;"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>
    <div class="imgs-gallery close" id="gallery">
        <div class="container">
            <div class="close" id="close-gallery"><i class="fa-solid fa-xmark"></i></div>
            <div class="title">Add Media</div>
            <ul>
                <li>Library</li>
                <li>Custom Images</li>
            </ul>
            <div class="wrapper">
                    <ul class="options">
                        <li data-img="bg">Backgrounds</li>
                        <li data-img="frame">Frames</li>
                        <li data-img="verse-frame">Verse Frames</li>
                    </ul>
                <div class="images-box" data-img="bg">
                    <img src="images/bg/paper.jpg" alt="">
                    <img src="images/bg/paper2.jpeg" alt="">
                </div>
                <div class="images-box none" data-img="frame">
                    <img src="images/frame/frame.png" alt="">
                    <img src="images/frame/frame2.png" alt="">
                </div>
                <div class="images-box none" data-img="verse-frame">
                    <img src="images/verse/verse-frame-brown.png" alt="">
                    <img src="images/verse/verse-frame-blue.png" alt="">
                </div>
            </div>
        </div>
    </div>
    <!-- <script src="js/main.js"></script> -->
    <script src="js/html2canvas.js"></script>
    <script>
        console.log();
        const exportBtn = document.getElementById('export');
        function doCapture() {
            html2canvas(document.getElementById("snip")).then(function (canvas) {
                const base64Image = canvas.toDataURL('image/jpeg');
                var anchor = document.createElement('a')
                anchor.setAttribute('href', base64Image);
                if(document.querySelector('.surah-name').textContent != '' && document.querySelectorAll('.verse-frame').length != 0) {
                    anchor.setAttribute('download', `${document.querySelector('.surah-name').textContent}_ayat_${document.querySelectorAll('.verse-frame')[0].textContent}_to_${document.querySelectorAll('.verse-frame').length}`)
                }else {
                    alert('Choose Ayat Firstly!')
                }
                anchor.click()
                anchor.remove();
            });
        }
    //     function doCaptureTest() {
    //     html2canvas(document.querySelector('.snip')).then(function (canvas) {
    //         var ajax = new XMLHttpRequest();
    //         // Setting method, server file name, and asynchronous
    //         ajax.open("POST", `php/save-snip.php`, true);
    //         // window.open(`../partials/save-capture.php?id=${id}`)
    //         // Setting headers for POST method
    //         ajax.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    //         // Sending image data to server
    //         ajax.send("image=" + canvas.toDataURL("image/jpeg", 0.9));
    //         // Receiving response from server
    //         // This function will be called multiple times
    //         ajax.onreadystatechange = function () {
    //             // Check when the requested is completed
    //             if (this.readyState == 4 && this.status == 200) {
    //                 console.log(this.responseText);
    //             }
    //         };
    //     });
    // }
        exportBtn.addEventListener('click', () => {
            document.querySelector(".snip").style.borderRadius = '0px'
            doCapture();
            document.querySelector(".snip").style.borderRadius = '8px'
        })
    </script>
    <script>
        const surahOpt = document.querySelector('.surah-options'),
        selectBtn = surahOpt.querySelector('.select-btn'),
        content = surahOpt.querySelector('.content'),
        searchInp = surahOpt.querySelector('input'),
        surahNamesDiv = surahOpt.querySelector('.options ul')
        let surahNames;
        let versesLi;
        const surahName = document.querySelector('.snip .surah-name')

        selectBtn.addEventListener('click', () => {
            content.classList.toggle('active')
        })

        fetch('data/quran_chapters.json')
            .then(async res => res.json())
            .then(data => {
                data.forEach(post => {
                    surahNamesDiv.insertAdjacentHTML('beforeend', `<li id="${post.id}surah" id2="${post.id}" data-chapter="${post.id}surah">${post.name}<li>`)
                    surahNames = document.querySelectorAll('.options ul li')
                })
                if(data) {
                    searchInp.addEventListener('keyup', () => {
                        let arrFr = []
                        let arr = []
                        let searchVal = searchInp.value.toLowerCase();
                        surahNames.forEach(surah => {
                            arrFr.push(surah.textContent)
                            if(arrFr.length == 228) {
                                arr = arrFr.filter(data => {
                                    return data.toLowerCase().startsWith(searchVal)
                                }).map(data => `<li>${data}</li>`).join()
                                surahNamesDiv.innerHTML = arr ? arr : `<p>Opp! No Surah With That Name</p>`;
                            }
                        });
                    })
                    surahNames.forEach(surah => {
                        if(surah.textContent == '') {
                            surah.remove()
                        }
                        surah.addEventListener('click', () => {
                            if(surah['id'].slice(0, surah['id'].indexOf('s')) < 10) {
                                surah.id = `00${surah.id}`
                            }else if(surah['id'].slice(0, surah['id'].indexOf('s')) > 10 && surah['id'].slice(0, surah['id'].indexOf('s')) < 100) {
                                surah.id = `0${surah.id}`
                            }else {
                                surah.id = `${surah.id}`
                            }
                            surahName.textContent = surah.id;
                            // const basmala = document.createElement('img')
                            // basmala.src = "../images/basmala.png"
                            // snip.append(basmala);
                            
                            const from = document.createElement('div')
                            from.classList.add('from')
                            const fromOptions = document.createElement('div')
                            fromOptions.classList.add('options')
                            const fromUL = document.createElement('ul')
                            const fromLabel = document.createElement('div')
                            const fromInp = document.createElement('input')
                            const row = document.createElement('div')
                            row.classList.add('row')
                            row.classList.add('row-from')
                            fromInp.setAttribute('placeholder', 'Enter Verse Number')
                            const fromIcon = document.createElement('i')
                            fromIcon.classList.add('fa-solid')
                            fromIcon.classList.add('fa-check')
                            fromInp.setAttribute('type', 'number')
                            fromLabel.classList.add('title')
                            fromLabel.innerHTML = 'Ayat From:'
                            fromOptions.append(fromUL)
                            row.append(fromInp)
                            row.append(fromIcon)
                            from.append(row)
                            from.append(fromOptions)
                            document.querySelector('.surah-options .chooser .wrapper').append(fromLabel)
                            document.querySelector('.surah-options .chooser .wrapper').append(row)
                            document.querySelector('.surah-options .chooser .wrapper').append(from)
                            fetch('data/quran_ar.json')
                                .then(res => res.json())
                                .then(data => {
                                    data[surah.getAttribute('id2')].forEach(post => {
                                    fromUL.insertAdjacentHTML('beforeend', `<li>${post.text} (${post.verse})<li>`)
                                        versesLi = document.querySelectorAll('.from ul li');
                                        versesLi.forEach(li => {
                                            if(li.textContent == '') {
                                                li.remove()
                                            }
                                        });
                                    })
                                })
                                fromInp.addEventListener('keyup', () => {
                                    let arrFr = []
                                    let arr = []
                                    let searchVal = fromInp.value.toLowerCase();
                                    versesLi.forEach(verse => {
                                        arrFr.push(verse.textContent)
                                        arr = arrFr.filter(data => {
                                            return data.toLowerCase().includes(searchVal);
                                        }).map(data => `<li>${data}</li>`).join(' ')
                                        fromUL.innerHTML = arr ? arr : `<p>Opp! No Verse With That Name</p>`;
                                    });
                                })
                                fromIcon.addEventListener('click', () => {
                                    if(fromInp.value != '') {
                                        document.querySelector('.row-from input').removeAttribute('type')
                                        document.querySelector('.row-from input').setAttribute('type', 'text');
                                        document.querySelector('.row-from input ').setAttribute('readonly', true);
                                        document.querySelector('.from').remove();


                                        const to = document.createElement('div')
                                        to.classList.add('to')
                                        const toOptions = document.createElement('div')
                                        toOptions.classList.add('options')
                                        const toUL = document.createElement('ul')
                                        const toLabel = document.createElement('div')
                                        const toInp = document.createElement('input')
                                        const row = document.createElement('div')
                                        row.classList.add('row')
                                        row.classList.add('row-to')
                                        toInp.setAttribute('placeholder', 'Enter Verse Number')
                                        const toIcon = document.createElement('i')
                                        toIcon.classList.add('fa-solid')
                                        toIcon.classList.add('fa-check')
                                        toInp.setAttribute('type', 'number')
                                        toLabel.classList.add('title')
                                        toLabel.innerHTML = 'Ayat to:'
                                        toOptions.append(toUL)
                                        row.append(toInp)
                                        row.append(toIcon)
                                        to.append(row)
                                        to.append(toOptions)
                                        document.querySelector('.surah-options .chooser .wrapper').append(toLabel)
                                        document.querySelector('.surah-options .chooser .wrapper').append(row)
                                        document.querySelector('.surah-options .chooser .wrapper').append(to)
                                        fetch('data/quran_ar.json')
                                            .then(res => res.json())
                                            .then(data => {
                                                data[surah.getAttribute('id2')].forEach(post => {
                                                    if(post.verse >= fromInp.value ? post.verse : '') {
                                                        toUL.insertAdjacentHTML('beforeend', `<li>${post.text} (${post.verse})<li>`)
                                                    }else {
                                                        return '' 
                                                    }
                                                    versesLi = document.querySelectorAll('.to ul li');
                                                    versesLi.forEach(li => {
                                                        if(li.textContent == '') {
                                                            li.remove()
                                                        }
                                                    });
                                                })
                                            })
                                            toInp.addEventListener('keyup', () => {
                                                let arrFr = []
                                                let arr = []
                                                let searchVal = toInp.value.toLowerCase();
                                                versesLi.forEach(verse => {
                                                    arrFr.push(verse.textContent)
                                                    arr = arrFr.filter(data => {
                                                        return data.toLowerCase().includes(searchVal);
                                                    }).map(data => `<li>${data}</li>`).join(' ')
                                                    toUL.innerHTML = arr ? arr : `<p>Opp! No Verse With That Name</p>`;
                                                });
                                            })
                                            toIcon.addEventListener('click', () => {
                                                document.querySelector('.row-to input').removeAttribute('type')
                                                document.querySelector('.row-to input').setAttribute('type', 'text');
                                                document.querySelector('.row-to input ').setAttribute('readonly', true);
                                                document.querySelector('.to').remove();

                                                fetch('data/quran_ar.json')
                                                .then(res => res.json())
                                                .then(data => {
                                                    const versesRow = document.createElement('div')
                                                    versesRow.id = 'row-verses'
                                                    versesRow.classList.add('row')
                                                    const versesTxt = document.createElement('p')
                                                    versesTxt.classList.add('verse');
                                                    data[surah.getAttribute('id2')].forEach(post => {
                                                        if(post.verse >= fromInp.value  && post.verse <= toInp.value) {
                                                            // console.log(post == );
                                                            let verseArr = ['1','2','3', '4','5','6','7','8','9'];
                                                            let verseArrAr = ['&#x0661;', '&#x0662;' , '&#x0663;' , '&#x0664;', '&#x0665;' , '&#x0666;', '&#x0667;', '&#x0668;', '&#x0669;'];
                                                            // for (let i = 0; i < verseArr.length; i++) {
                                                                //     if(post.verse.toString().includes(verseArr[i])) {
                                                                    //         verseArr = ['&#x0661;', '&#x0662;' , '&#x0663;' , '&#x0664;', '&#x0665;' , '&#x0666;', '&#x0667;', '&#x0668;', '&#x0669;']
                                                                    //         post.verse[i] = verseArr; 
                                                                    //         console.log(post.verse[i]);
                                                                    //     }
                                                                    // }
                                                                    // versesTxt.innerHTML = `${post.text} <span class="verse-frame">${post.verse == verseArr ? verseArrAr : ''}</span>`
                                                            versesTxt.innerHTML += `${post.text} <span class="verse-frame">${post.verse}</span>`
                                                            versesRow.append(versesTxt)
                                                            snip.append(versesRow)
                                                        }
                                                    })
                                                })
                                            })
                                    }else {
                                        alert('You Have To Enter A Number')
                                    }
                                })
                            })
                        surah.onclick = () => {
                            content.remove()
                        }
                    })
                }
            })
    </script>
    <script>
        const snip = document.getElementById('snip')
        const surahFrame = document.querySelector('#surah-frame')
        const width = document.getElementById('width')
        const height = document.getElementById('height')
        const removeGallery = document.getElementById('close-gallery');
        const removePicker = document.getElementById('close-picker');
        const colorOptions = document.getElementById('color-options');
        const colorPickerDiv = document.querySelector('.color-picker-div')
        colorPickerDiv.style.background = window.getComputedStyle(snip).backgroundColor;
        const imgsGallery = document.querySelector('.imgs-gallery')
        const galleryLinks = document.querySelectorAll('.imgs-gallery ul li')
        const imagesBox = document.querySelectorAll('.images-box')
        const imgsBg = document.querySelectorAll('.images-box[data-img="bg"] img')
        const imgsFrame = document.querySelectorAll('.images-box[data-img="frame"] img')
        const imgsVerseFrame = document.querySelectorAll('.images-box[data-img="verse-frame"] img')
        const imgChooser = document.querySelector('.img-chooser')
        const imgOptions = document.querySelectorAll('.options li[data-img]')
        const hexColor = document.querySelector('.hex-color')
        const hexColorDiv = document.querySelector('.hex-color-div')
        const check = document.querySelector('.check')

        check.addEventListener('click', () => {
            hexColorDiv.style.background = hexColor.value;
            snip.style.background = hexColor.value;
            colorPickerDiv.style.background = hexColor.value;
        })

        removePicker.addEventListener('click', () => {
            colorOptions.classList.add('close')
        })

        removeGallery.addEventListener('click', () => {
            imgsGallery.classList.add('close')
        })

        imgChooser.addEventListener('click', () => {
            imgsGallery.classList.remove('close')
        })

    console.log(imgOptions);

        imgOptions.forEach(opt => {
            opt.addEventListener('click', () => {
                if(opt.getAttribute('data-img') == 'bg') {
                    imagesBox.forEach(box => {
                        box.getAttribute('data-img') == 'bg' ? box.classList.remove('none') : box.classList.add('none')
                    });
                }else if(opt.getAttribute('data-img') == 'frame'){
                    imagesBox.forEach(box => {
                        box.getAttribute('data-img') == 'frame' ? box.classList.remove('none') : box.classList.add('none')
                    });
                }else {
                    imagesBox.forEach(box => {
                        box.getAttribute('data-img') == 'verse-frame' ? box.classList.remove('none') : box.classList.add('none')
                    });
                }
            })
        });
        colorPickerDiv.addEventListener('click', () => {
            colorOptions.classList.remove('close')
        })
        width.addEventListener('change', () => {
            snip.style.width = `${width.value}px`;
            console.log(width.value);
        })
        width.addEventListener('keyup', () => {
            snip.style.width = `${width.value}px`;
        })
        height.addEventListener('change', () => {
            snip.style.height = `${height.value}px`;
        })
        height.addEventListener('keyup', () => {
            snip.style.height = `${height.value}px`;
        })

        // const suggestedColors = document.querySelectorAll('.suggested-color')

        // suggestedColors.forEach(color => {
        //     color.addEventListener('click', () => {

        //     })
        // });

        class ColorPicker {
            constructor(root) {
                this.root = root;
                this.colorjoe = colorjoe.rgb(this.root.querySelector(".colorjoe"));
                this.selectedColor = null;
                this.savedColors = this.getSavedColors();
                this.colorjoe.show();
                // this.setSelectedColor("#faf1e3");

                this.colorjoe.on("change", color => {
                    this.setSelectedColor(color.hex(), true);
                });

                this.root.querySelectorAll(".saved-color").forEach((el, i) => {
                    this.showSavedColor(el, this.savedColors[i]);

                    el.addEventListener("mouseup", e => {
                        if (e.button == 1) {
                            this.saveColor(this.selectedColor, i);
                            this.showSavedColor(el, this.selectedColor);
                        }

                        this.setSelectedColor(el.dataset.color);
                    });
                });
            }


            setSelectedColor(color, skipCjUpdate = false) {
                this.selectedColor = color;
                this.root.querySelector(".selected-color-text").value = color;
                this.root.querySelector(".selected-color").style.background = color;
                snip.style.background = color;
                colorPickerDiv.style.background = color;

                if (!skipCjUpdate) {
                    this.colorjoe.set(color);
                }
            }
            getSavedColors() {
                const saved = JSON.parse(localStorage.getItem("colorpicker-saved") || "[]");

                return new Array(5).fill("#ffffff").map((defaultColor, i) => {
                    return saved[i] || defaultColor;
                });
            }

            showSavedColor(element, color) {
                element.style.background = color;
                element.dataset.color = color;
            }

            saveColor(color, i) {
                this.savedColors[i] = color;
                localStorage.setItem("colorpicker-saved", JSON.stringify(this.savedColors));
            }
        }
        document.querySelector('.copy').addEventListener('click', () => {
            document.querySelector(".selected-color-text").select();
            document.execCommand('copy')
        })
        const cp = new ColorPicker(document.querySelector(".color-container"));
    

        galleryLinks.forEach(link => {
            link.addEventListener('click', () => {
                for (let i = 0; i < galleryLinks.length; i++) {
                    galleryLinks[i].classList.remove('active')
                }
                link.classList.add('active')
            })
        });

        imgsBg.forEach(img => {
            img.addEventListener('click', () => {
                console.log(img.src);
                imgsGallery.classList.add('close')
                imgChooser.style.background = `url("${img.src}")`
                snip.style.background = `url("${img.src}")`
            })
        });
        imgsFrame.forEach(img => {
            img.addEventListener('click', () => {
                console.log(img.src);
                imgsGallery.classList.add('close')
                console.log(surahFrame);
                surahFrame.src = `${img.src}`
            })
        });
        imgsVerseFrame.forEach(img => {
            img.addEventListener('click', () => {
                console.log(img.src);
                imgsGallery.classList.add('close')
                document.querySelectorAll('.verse-frame').forEach(frame => {
                    frame.style.backgroundImage = `url(${img.src})`
                })
            })
        });
    
    
    
    
    </script>
</body>
</html>